
cmake_minimum_required(VERSION 3.9)
project(ionFinder VERSION 0.2.1)

set(LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lib)

option(BUILD_UTILS "Enable building utils lib" ON)
option(BUILD_ION_FINDER "Enable building ionFinder" ON)

if(BUILD_UTILS)
	add_library(utils INTERFACE)
	set(UTILS_VERSION "1.3.0")

	include(ExternalProject)
	include(GNUInstallDirs)

	set(UTILS_PREFIX "utils-${UTILS_VERSION}")

	ExternalProject_Add(${UTILS_PREFIX}
		SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/utils
		BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR}/utils
		CMAKE_ARGS "-DCMAKE_C_FLAGS=${CMAKE_C_FLAGS}"
			"-DCMAKE_CXX_FLAGS=${CMAKE_CXX_FLAGS}"
			"-DCMAKE_INSTALL_PREFIX=${CMAKE_CURRENT_BINARY_DIR}"
			"-DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}"
			"-DCMAKE_SYSTEM_NAME=${CMAKE_SYSTEM_NAME}"
			"-DCMAKE_SYSTEM_PROCESSOR=${CMAKE_SYSTEM_PROCESSOR}"
			"-DCMAKE_AR=${CMAKE_AR}"
			"-DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}"
			"-DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}"
			"-DCMAKE_RC_COMPILER=${CMAKE_RC_COMPILER}"
			"-DCMAKE_COMPILER_PREFIX=${CMAKE_COMPILER_PREFIX}"
			"-DCMAKE_FIND_ROOT_PATH=${CMAKE_FIND_ROOT_PATH}"
		)

	add_dependencies(utils ${UTILS_PREFIX})
	set(UTILS_LIBRARY ${LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_STATIC_LIBRARY_PREFIX}utils${CMAKE_STATIC_LIBRARY_SUFFIX})
	set(UTILS_INCLUDE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/utils/include)

	message("${UTILS_LIBRARY}")
	message("${UTILS_INCLUDE_DIR}")
endif()

if(BUILD_ION_FINDER)
	add_subdirectory("ionFinder")
endif()

